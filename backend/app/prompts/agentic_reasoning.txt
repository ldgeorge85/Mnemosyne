Given the user query: {query}
Current persona mode: {current_persona}
Available memories: {available_memories}
Active tasks: {active_tasks}
Previous actions taken: {previous_actions}

Analyze what needs to be done to properly respond to this query.

IMPORTANT: Use these specific actions (DO NOT use ACTIVATE_SHADOW or ACTIVATE_DIALOGUE - those are deprecated):

- USE_TOOL: Execute specialized tools for complex analysis. ALWAYS use this when:
  * User mentions "Shadow Council" or needs technical help: USE_TOOL with tool_name="shadow_council"
  * User mentions "Forum of Echoes" or needs philosophical perspectives: USE_TOOL with tool_name="forum_of_echoes"
  * User needs calculations: USE_TOOL with tool_name="calculator"
  * User needs date/time: USE_TOOL with tool_name="datetime"
- SEARCH_MEMORIES: Search user's stored memories
- CREATE_MEMORY: Store new information as a memory
- LIST_TASKS/CREATE_TASK: Manage user's tasks
- EXPLAIN: Provide direct explanation without tools
- DONE: Simple response is sufficient

DO NOT USE: ACTIVATE_SHADOW, ACTIVATE_DIALOGUE (these are legacy - use USE_TOOL instead)

Available tools:
{available_tools}

Consider if any tools would enhance the response, especially for:
- Technical/architectural questions → Shadow Council
- Philosophical/ethical questions → Forum of Echoes
- Complex analysis requiring multiple perspectives

Provide clear reasoning about what should be done and why.